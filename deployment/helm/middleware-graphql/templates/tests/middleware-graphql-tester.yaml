apiVersion: v1
kind: Pod
metadata:
  name: "middleware-graphql-tests"
  namespace: {{ .Values.namespace }}
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
  - name: middleware-graphql-tester
    image: "{{ .Values.image.repository }}/middleware-graphql-tester:{{ .Values.image.tag }}"
    imagePullPolicy: {{ .Values.image.pullPolicy }}
    resources:
        limits:
          cpu: "{{ .Values.resources.tester.limits.cpu }}"
          memory: "{{ .Values.resources.tester.limits.memory }}"
        requests:
          cpu: "{{ .Values.resources.tester.requests.cpu }}"
          memory: "{{ .Values.resources.tester.requests.memory }}"
    env:
      - name: REDIS_AUTH_ENABLED
        value: "true"
      - name: ORIENT_CNX_HOST
        valueFrom:
          configMapKeyRef:
            name: {{ .Values.env.configMapKeyRef.name }}
            key: orient-cnx-host
      - name: ORIENT_CNX_SCHEME
        valueFrom:
          configMapKeyRef:
            name: {{ .Values.env.configMapKeyRef.name }}
            key: orient-cnx-scheme
    command: ["sh", "-c", "/usr/src/app/tests/runtest.sh"]
  restartPolicy: Never
